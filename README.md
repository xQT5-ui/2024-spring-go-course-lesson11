# Домашнее задание №11: Запросы в Postgres
Цель домашнего задания - изучить основы работы с реляционной базой данных Postgres

### Подготовка
Перед началом работы необходимо установить [docker, docker-compose](https://docs.docker.com/compose/install/).

### Запуск
```shell
docker-compose up
```
Docker запустит два инстанса: `админку` и `postgres`.  
В postgres уже будет предустановленная БД с данными по "умному дому", содержащая следующие таблицы:
* sensors - таблица содержит информацию о датчиках;
* users - таблица содержит информацию о пользователях;
* events - таблица содержит информацию о событиях с датчиков;
* sensors_users - таблица представляет связь многие ко многим.

### Как работать с админкой?
1. ждём когда `postgres` загрузит таблицы;  
   `postgres_1  | 2024-05-06 11:15:14.350 UTC [1] LOG:  database system is ready to accept connections`
2. после запуска контейнеров открываем браузер и переходим на `localhost:5050`;
3. вводим пароль `123`;  
   ![img1](./images/img1.png)
4. далее нужно подключиться к БД, для этого слева правой кнопкой мыши кликаем на servers -> register -> Servers...;
5. вводим имя `smarthome`;  
   ![img2](./images/img2.png)
6. в `connections` вводим хост `postgres` и пароль `123`, сохраняем;
   ![img3](./images/img3.png)
7. В левом углу должен появиться слоник и в схемах `go_course_db`;  
   ![img4](./images/img4.png)
8. кликаем правой кнопкой мыши на `go_course_db` выбираем `Query Tool` и в появившимся окне вводим:
```sql
select * from go_course_db.users
```
   

### Задачи
Необходимо написать sql запросы, дающие ответы на следующие вопросы:
* число активных датчиков - 1 балл;
* самый популярный тип датчика - 2 балла;
* топ 3 пользователя у которых больше всех активных датчиков - 3 балла;
* Выведите максимальную температуру по дням для датчика c `sensor_id=12` отсортированного по убыванию температуры - 4 балла.

В последнем задании предполагается поработать над оптимизацией запроса, по этому 4 балла выставляется если `cost` < 10000  
Также в файле `optimize.sql` к 4ой задаче нужно прикрепить `explain analyse` запроса - оформить как комментарий в фаиле

__Итоговые запросы по каждой задаче необходимо написать в соответствующих фаилах в папке tasks__ 

### FAQ
Возможно из-за новой версии compose у вас будет ругаться на наличие `version` при запуске.  
Для этого в файле `docker-compose.yml` нужно:
1. удалить `version: 3.9`;
2. вставить строку `name: go-course`.
